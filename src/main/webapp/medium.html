<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">

<head>

    <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
    <title>TP 3IF Ajax</title>
    <meta name="author" content="Előd EGYED-ZSIGMOND">

    <script type="text/javascript" src="partieJavascript.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>

<body>
    <h1>Informations sur le medium</h1>
    <br />
    <span id="name">Nom : </span>
    <br />
    <span id="description">Description : </span>
    <br />
    <span id="type"></span>
    <br />
    <input name="Retour" type="button" id="return" value="Retour" />










    <script>
        var connected = false;
        $(document).ready(function () {
            $("#return").on("click", function () {
                window.location = "mainPage.html"
            });
            $.ajax({
                url: './ActionServlet',
                type: 'POST',
                data: {
                    todo: 'accueil_connexion',
                    id: getUrlParameter('id')
                },
                dataType: 'json'
            })
                .done(function (response) {
                    if (response.type == "employee") {
                        window.location = "employee.html"
                    } else if (response.connected == "false") {
                        $("#signin").show();
                        $("#login").show();
                        $("#history").hide();
                    } else if (response.connected == "true") {
                        $("#signin").hide();
                        $("#login").hide();
                        $("#history").show();
                        connected = true;
                    }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.error("Erreur lors de la requête AJAX : " + textStatus, errorThrown);
                });
            $.ajax({
                url: './ActionServlet',
                type: 'POST',
                data: {
                    todo: 'accueil_liste_medium',
                },
                dataType: 'json'
            })
                .done(function (liste) {
                    let listeMediums = $("#mediumList");
                    listeMediums.empty();
                    for (const medium of liste) {
                        listeMediums.append("<li id=" + medium.id + ">" + medium.denomination + " : " + medium.description + "</li>");
                        $("#" + medium.id).on("click", function () {
                            if (connected) {
                                window.location = "medium.html?id=" + medium.id;
                            } else {
                                alert("Vous devez être connecté pour accéder à cette page.");
                            }
                        });
                    }
                })
                .fail(function (jqXHR, textStatus, errorThrown) {
                    console.error("Erreur lors de la requête AJAX : " + textStatus, errorThrown);
                });
        });
    </script>

</body>

</html>